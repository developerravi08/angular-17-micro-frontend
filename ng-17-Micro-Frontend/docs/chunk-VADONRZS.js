var b=Object.defineProperty,j=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var g=(e,t,o)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,i=(e,t)=>{for(var o in t||={})$.call(t,o)&&g(e,o,t[o]);if(w)for(var o of w(t))U.call(t,o)&&g(e,o,t[o]);return e},l=(e,t)=>j(e,F(t));var a=(e,t,o)=>new Promise((n,r)=>{var s=c=>{try{u(o.next(c))}catch(f){r(f)}},m=c=>{try{u(o.throw(c))}catch(f){r(f)}},u=c=>c.done?n(c.value):Promise.resolve(c.value).then(s,m);u((o=o.apply(e,t)).next())});function h(e,t){return{imports:i(i({},e.imports),t.imports),scopes:i(i({},e.scopes),t.scopes)}}var E=new Map;function N(e){return`${e.packageName}@${e.version}`}function z(e){let t=N(e);return E.get(t)}function x(e,t){let o=N(e);E.set(o,t)}function d(e){let t=e.split("/");return t.pop(),t.join("/")}function p(e,t){for(;e.endsWith("/");)e=e.substring(0,e.length-1);return t.startsWith("./")&&(t=t.substring(2,t.length)),`${e}/${t}`}var M=new Map,y=new Map;function B(e,t){M.set(e,t),y.set(t.baseUrl,e)}function K(e){return y.get(e)}function T(e){return y.has(e)}function v(e){return M.get(e)}function I(e){document.body.appendChild(Object.assign(document.createElement("script"),{type:"importmap-shim",innerHTML:JSON.stringify(e)}))}function G(){return a(this,arguments,function*(e={}){let t=typeof e=="string"?yield H(e):e,o=yield D(),n=yield P(t),r=h(o,n);return I(r),r})}function H(e){return a(this,null,function*(){return yield fetch(e).then(t=>t.json())})}function P(e){return a(this,null,function*(){let t={imports:{},scopes:{}};for(let o of Object.keys(e))try{let n=e[o],r=yield k(n,o);t=h(t,r)}catch{console.error(`Error loading remote entry for ${o} from file ${e[o]}`)}return t})}function k(e,t){return a(this,null,function*(){let o=d(e),n=yield R(e);t||(t=n.name);let r=S(n,t,o);return B(t,l(i({},n),{baseUrl:o})),r})}function S(e,t,o){let n=C(e,t,o),r=W(e,o);return{imports:n,scopes:r}}function R(e){return a(this,null,function*(){return yield fetch(e).then(o=>o.json())})}function W(e,t){let o={},n={};for(let r of e.shared){let s=z(r)??p(t,r.outFileName);x(r,s),n[r.packageName]=s}return o[t+"/"]=n,o}function C(e,t,o){let n={};for(let r of e.exposes){let s=p(t,r.key),m=p(o,r.outFileName);n[s]=m}return n}function D(){return a(this,null,function*(){let e=yield R("./remoteEntry.json"),t=e.shared.reduce((o,n)=>l(i({},o),{[n.packageName]:"./"+n.outFileName}),{});for(let o of e.shared)x(o,"./"+o.outFileName);return{imports:t,scopes:{}}})}function O(e,t){return a(this,null,function*(){let o=q(e,t);yield L(o);let n=J(o),r=v(n);if(!r)throw new Error("unknown remote "+n);let s=r.exposes.find(c=>c.key===o.exposedModule);if(!s)throw new Error(`Unknown exposed module ${o.exposedModule} in remote ${n}`);let m=p(r.baseUrl,s.outFileName);return yield importShim(m)})}function J(e){let t;if(e.remoteName)t=e.remoteName;else if(e.remoteEntry){let o=d(e.remoteEntry);t=K(o)}else throw new Error("unexpcted arguments: Please pass remoteName or remoteEntry");if(!t)throw new Error("unknown remoteName "+t);return t}function L(e){return a(this,null,function*(){if(e.remoteEntry&&!T(d(e.remoteEntry))){let t=yield k(e.remoteEntry);I(t)}})}function q(e,t){let o;if(typeof e=="string"&&t)o={remoteName:e,exposedModule:t};else if(typeof e=="object"&&!t)o=e;else throw new Error("unexpected arguments: please pass options or a remoteName/exposedModule-pair");return o}export{G as a,O as b};
